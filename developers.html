<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Developer documentation &#8212; wastd 0.70.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=ecf2ad1f"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Third party access" href="third_party_access.html" />
    <link rel="prev" title="Business Analysts" href="business_analysts.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="developer-documentation">
<span id="dev-docs"></span><h1>Developer documentation<a class="headerlink" href="#developer-documentation" title="Link to this heading">¶</a></h1>
<p>This chapter is targetted at developers and those who would like to understand
the underlying data model.</p>
<p>In this chapter, we will discuss:</p>
<ul class="simple">
<li><p>the data model - what data can WAStD handle?</p></li>
<li><p>the admin - manual data entry, validation, widgets</p></li>
<li><p>the API - programmatic data retrieval and query</p></li>
<li><p>the custom User app</p></li>
<li><p>remaining modules of the observations app</p></li>
<li><p>design smells</p></li>
</ul>
<section id="design-smells">
<span id="id1"></span><h2>Design smells<a class="headerlink" href="#design-smells" title="Link to this heading">¶</a></h2>
<p>Let’s start this chapter with early design decisions that could be refactored to be improved.</p>
<section id="unique-identifiers">
<h3>Unique identifiers<a class="headerlink" href="#unique-identifiers" title="Link to this heading">¶</a></h3>
<p>Fields with unique identifiers are called <code class="docutils literal notranslate"><span class="pre">name</span></code>. The word <code class="docutils literal notranslate"><span class="pre">name</span></code> is overloaded.
The mixin class <code class="docutils literal notranslate"><span class="pre">shared.models.CodeLabelDescriptionMixin</span></code> brings three fields:</p>
<ul class="simple">
<li><p>code  - a unique, short, URL-safe short code</p></li>
<li><p>label - a human-readable label</p></li>
<li><p>description - a longer, comprehensive, complete description</p></li>
</ul>
<p>Smell: inconsistent use of “name”, “label”, for unique identifiers across the codebase and docstrings.</p>
</section>
<section id="legacy-sources">
<h3>Legacy sources<a class="headerlink" href="#legacy-sources" title="Link to this heading">¶</a></h3>
<p>Two competing ways of tracking an upstream point of truth:
<code class="docutils literal notranslate"><span class="pre">shared.models.LegacySourceMixin</span></code> and per model ChoiceField lookups.
The underlying value is either a SmallInt (quick lookups, but incomrehensive to the user), or a short string.</p>
<p>Smell: refactor to use <code class="docutils literal notranslate"><span class="pre">shared.models.LegacySourceMixin</span></code>. Mind that R package wastdr and ETL pipelines need to be updated too.</p>
</section>
<section id="hard-coded-lookups">
<h3>Hard-coded lookups<a class="headerlink" href="#hard-coded-lookups" title="Link to this heading">¶</a></h3>
<p>Hard-coding lookups prevents data corruption by over-eager admin users.
Since we have much higher code churn than data model churn, these lookups are easy enough to maintain.</p>
<p>Smell: where to define lookup dicts - currently mixed in <code class="docutils literal notranslate"><span class="pre">observations.models</span></code> at both top level and model level.</p>
</section>
</section>
<section id="extending-the-application">
<span id="extend-app"></span><h2>Extending the application<a class="headerlink" href="#extending-the-application" title="Link to this heading">¶</a></h2>
<section id="observationgroup">
<h3>ObservationGroup<a class="headerlink" href="#observationgroup" title="Link to this heading">¶</a></h3>
<p>TFA, TFL, TEC paper forms contain further observation groups, which
are reviewed and evaluated for trustworthiness separately.</p>
<p>Each group becomes a model in TSC, inheriting from <code class="docutils literal notranslate"><span class="pre">occurrences.models.ObservationGroup</span></code>.
WAStD can add new instances of <code class="docutils literal notranslate"><span class="pre">Observation</span></code>.</p>
<ul class="simple">
<li><p>Model: add model to <code class="docutils literal notranslate"><span class="pre">occurrences.models</span></code> inheriting from ObservationGroup.</p></li>
<li><p>Migration: create, run in dev.</p></li>
<li><p>Form: create form for use in admin and views.</p></li>
<li><p>Admin: add Inline and standalone admin.</p></li>
<li><p>Views: CreateView, UpdateView. DetailView is that of related encounter.</p></li>
<li><p>URLs: create and update URLs. Add <code class="docutils literal notranslate"><span class="pre">update_url</span></code> to model.</p></li>
<li><p>Templates: card template for obsgroup model, add “create” link to either CAE/TAE detail template where applicable.</p></li>
<li><p>Tests: Create sample instances, view on detail page. Call create and update urls.</p></li>
<li><p>Docs: Migrate legacy docs on how to fill in the obsgroup sections.</p></li>
<li><p>DevOps: git, docker, deploy, migrate.</p></li>
</ul>
</section>
</section>
<section id="data-model">
<span id="id2"></span><h2>Data model<a class="headerlink" href="#data-model" title="Link to this heading">¶</a></h2>
<p>WAStD is designed to handle biological
observations of any kind which happen during an encounter.</p>
<p>Both Encounters and Observations are polymorphic (database table inheritance)
and share one primary key, while allowing for different fields for child models.</p>
<p>E.g., AnimalEncounters are Encounters (where, when, observed by, recorded by)
with an Animal (species, sex, maturity, health). The combination of Animal
attributes can determine which subsequent Observations are required.</p>
<p>Following this “mix&amp;match” approach, e.g. an AnimalEncounter with a dead turtle
will be a “Turtle Stranding” encounter, requiring TurtleMorphometricObesrvations,
DistinguishingFeatureObservations, TurtleDamageObservations etc.</p>
<p>An AnimalEncounter with a nesting (= female, mature) turle will be a “Turtle
Tagging” encounter, which requires a TurtleNestObservation, plus the above
types of observations.</p>
<p>Both encounters will share MediaAttachments (photos, scanned field data sheet)
and (if appropriate) TagObservations (flipper / PIT / satellite tags, biopsy
samples etc.).</p>
<img alt="WAStD data model" src="_images/datamodel.png" />
<section id="observations-models-module">
<h3><cite>observations.models</cite> Module<a class="headerlink" href="#observations-models-module" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="admin">
<h2>Admin<a class="headerlink" href="#admin" title="Link to this heading">¶</a></h2>
<p>We’re using a nicely styled admin to let trained data entry operators and
curators add and update data.</p>
<p>Also, data analysts can search, filter, and export data from here.</p>
<section id="observations-admin-module">
<h3><cite>observations.admin</cite> Module<a class="headerlink" href="#observations-admin-module" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p>The API is intended for programmatic access to data, mainly to batch-import
and batch-export.</p>
</section>
<section id="the-rest">
<h2>The rest<a class="headerlink" href="#the-rest" title="Link to this heading">¶</a></h2>
<p>This concludes the documentation of the key features.
The following sections document the remaining modules for completeness’ sake.</p>
<section id="users-app">
<h3><cite>users</cite> app<a class="headerlink" href="#users-app" title="Link to this heading">¶</a></h3>
<p>WAStD’s custom user package, courtesy of pydanny’s django project template.</p>
</section>
<section id="observations-app">
<h3><cite>observations</cite> app<a class="headerlink" href="#observations-app" title="Link to this heading">¶</a></h3>
<p>Remaining modules of the observations package are documented here.</p>
<section id="project-delivery-ticking-the-boxes">
<h4>Project delivery: ticking the boxes<a class="headerlink" href="#project-delivery-ticking-the-boxes" title="Link to this heading">¶</a></h4>
<p>This chapter closes the development circle by pairing functional requirements with
corresponding functional, unit and view tests.
The tests are documented inline with the requirements they cover; the documentation
is extracted in the build process and shown below.</p>
<p>This chapter should read to business owners as a walk-through of their business processes.
Ideally, all requirements from the detailed requirements analysis find their counterpart in the following section.</p>
<p>Tests are structured into:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Unit tests: the basics</dt><dd><ul>
<li><p>data structure (model X must have field Y),</p></li>
<li><p>model functions (string representation of model X must include field Y)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>View tests: the boring bits</dt><dd><ul>
<li><p>Do all pages load?</p></li>
<li><p>Do named URLs work?</p></li>
<li><p>Are all required page HTML templates in place?</p></li>
<li><p>Do all view functions work?</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Functional tests: the meat and potatoes</dt><dd><ul>
<li><p>Business logic: following real-world scenarios</p></li>
<li><p>Permissions: which role can see / do what when?</p></li>
<li><p>Conditions: what needs to be done and present before a step can be executed?</p></li>
<li><p>Consequences: what will happen if I hit this button?</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
</section>
<section id="wa-strandings-and-wa-sea-turtles">
<h2>WA Strandings and WA Sea Turtles<a class="headerlink" href="#wa-strandings-and-wa-sea-turtles" title="Link to this heading">¶</a></h2>
<section id="observations">
<h3>Observations<a class="headerlink" href="#observations" title="Link to this heading">¶</a></h3>
<p><cite>observations.tests</cite> Module</p>
</section>
<section id="users">
<h3>Users<a class="headerlink" href="#users" title="Link to this heading">¶</a></h3>
<p><cite>users.tests</cite> Module</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">wastd</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_entry.html">Data entry</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_qa.html">Data QA</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_consumers.html">Data consumers</a></li>
<li class="toctree-l1"><a class="reference internal" href="business_analysts.html">Business Analysts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#design-smells">Design smells</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unique-identifiers">Unique identifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#legacy-sources">Legacy sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hard-coded-lookups">Hard-coded lookups</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extending-the-application">Extending the application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#observationgroup">ObservationGroup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-model">Data model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#observations-models-module"><cite>observations.models</cite> Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#admin">Admin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#observations-admin-module"><cite>observations.admin</cite> Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-rest">The rest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#users-app"><cite>users</cite> app</a></li>
<li class="toctree-l3"><a class="reference internal" href="#observations-app"><cite>observations</cite> app</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wa-strandings-and-wa-sea-turtles">WA Strandings and WA Sea Turtles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#observations">Observations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#users">Users</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="third_party_access.html">Third party access</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="business_analysts.html" title="previous chapter">Business Analysts</a></li>
      <li>Next: <a href="third_party_access.html" title="next chapter">Third party access</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023, Florian Mayer, Ashley Felton.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/developers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>