{% extends "base_wastd.html" %}
{% load static bootstrap4 %}

{% block extra_style %}
{{ block.super }}
<style>
.import-form {
    max-width: 800px;
    margin: 0 auto;
}
.form-group {
    margin-bottom: 1.5rem;
}
.help-text {
    font-size: 0.9em;
    color: #6c757d;
    margin-top: 0.25rem;
}
.notes-section {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 1.5rem;
    margin-top: 2rem;
}
.notes-section h5 {
    color: #495057;
    margin-bottom: 1rem;
}
.notes-section ul {
    margin-bottom: 0;
}
.notes-section li {
    margin-bottom: 0.5rem;
}
.btn-import {
    background-color: #007bff;
    border-color: #007bff;
    padding: 0.75rem 2rem;
    font-size: 1.1rem;
}
.btn-import:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}
.back-link {
    color: #6c757d;
    text-decoration: none;
    margin-bottom: 1rem;
    display: inline-block;
}
.back-link:hover {
    color: #495057;
    text-decoration: none;
}
</style>
{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="d-none d-md-block">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">Admin</a></li>
        <li class="breadcrumb-item"><a href="{% url 'admin:observations_area_changelist' %}">Areas</a></li>
        <li class="breadcrumb-item active" aria-current="page">Import GeoJSON</li>
    </ol>
</nav>
{% endblock %}

{% block page_content_inner %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-upload"></i> Import Areas from GeoJSON
                </h4>
            </div>
            <div class="card-body">
                <a href="{% url 'admin:observations_area_changelist' %}" class="back-link">
                    <i class="fas fa-arrow-left"></i> Back to Areas List
                </a>
                
                <form method="post" enctype="multipart/form-data" class="import-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="{{ form.file.id_for_label }}" class="form-label">
                            {{ form.file.label }}
                        </label>
                        <input type="file" name="{{ form.file.name }}" id="{{ form.file.id_for_label }}" class="form-control" accept=".geojson,.json">
                        {% if form.file.help_text %}
                            <div class="help-text">{{ form.file.help_text }}</div>
                        {% endif %}
                        {% if form.file.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.file.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" name="{{ form.update_on_duplicate.name }}" id="{{ form.update_on_duplicate.id_for_label }}" class="form-check-input" {% if form.update_on_duplicate.value %}checked{% endif %}>
                            <label for="{{ form.update_on_duplicate.id_for_label }}" class="form-check-label">
                                {{ form.update_on_duplicate.label }}
                            </label>
                        </div>
                        {% if form.update_on_duplicate.help_text %}
                            <div class="help-text">{{ form.update_on_duplicate.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.default_area_type.id_for_label }}" class="form-label">
                            {{ form.default_area_type.label }}
                        </label>
                        <select name="{{ form.default_area_type.name }}" id="{{ form.default_area_type.id_for_label }}" class="form-control">
                            <option value="">---------</option>
                            {% for value, label in form.default_area_type.field.choices %}
                                <option value="{{ value }}" {% if form.default_area_type.value == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        {% if form.default_area_type.help_text %}
                            <div class="help-text">{{ form.default_area_type.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.name_field.id_for_label }}" class="form-label">
                            {{ form.name_field.label }}
                        </label>
                        <input type="text" name="{{ form.name_field.name }}" id="{{ form.name_field.id_for_label }}" class="form-control" value="{{ form.name_field.value|default:'' }}" placeholder="name">
                        {% if form.name_field.help_text %}
                            <div class="help-text">{{ form.name_field.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.type_field.id_for_label }}" class="form-label">
                            {{ form.type_field.label }}
                        </label>
                        <input type="text" name="{{ form.type_field.name }}" id="{{ form.type_field.id_for_label }}" class="form-control" value="{{ form.type_field.value|default:'' }}" placeholder="area_type">
                        {% if form.type_field.help_text %}
                            <div class="help-text">{{ form.type_field.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group text-center">
                        <button type="submit" class="btn btn-primary btn-import">
                            <i class="fas fa-upload"></i> Import Areas
                        </button>
                    </div>
                </form>

                <div class="notes-section">
                    <h5><i class="fas fa-info-circle"></i> Instructions</h5>
                    <ul>
                        <li>This tool only supports GeoJSON format, the coordinate system is assumed to be <code>EPSG:4326 (WGS84)</code></li>
                        <li>The default fields are <code>name</code> and <code>type</code> as name and area type; if missing, the default type or field name can be set in the form.</li>
                        <li>The geometry must be <code>Polygon</code> or <code>MultiPolygon</code> (the latter takes the largest face).</li>
                        <li>Invalid geometry will not be imported, and the error message will be displayed on the page.</li>
                        <li>Duplicate areas (same area_type + name) will be updated based on the "Update duplicate items" option.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
